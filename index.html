<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>R-R-Racer</title>
		<script type="text/javascript">
			function microphoneReady() {
				hideFlashOverlay();
			}

			function hideFlashOverlay() {
				var overlay = document.getElementById("flashOverlay");
				if (overlay) overlay.style.display = 'none';
				setTimeout(function() { document.body.tabIndex = 0; document.body.focus();}, 300);
			}
		</script>
		<script type="text/javascript" src="js/soundsensor.js"></script>
		<link rel="stylesheet" type="text/css" href="css/soundsensor.css"/>
		<link rel="stylesheet" type="text/css" href="css/common_veli.css"/>
		<link rel="stylesheet" type="text/css" href="css/mobile.css"/>
	 </head>
 <body>
	 <!-- Begin soundsensor replacement -->
     <div id="flashOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:9999; color:white; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;">
        <!-- <h1 style="font-size: 40px; margin-bottom: 20px;">R-R-Racer</h1> -->
        <p style="font-size: 20px; max-width: 600px; margin-bottom: 30px;">
            This game is controlled by your voice.<br>
            Hum like an engine to drive!
        </p>
        <button id="startAudioBtn" onclick="startSoundSensor()" style="font-size:24px; padding:15px 30px; cursor:pointer; background: #ffcc00; border: none; border-radius: 5px; color: black; font-weight: bold;">
            Enable Microphone
        </button>
     </div>
     <!-- End soundsensor replacement -->
	 	 
	 <!-- Begin jracer -->
  <div id='instructions'>
    <p style="text-align: center">Hum like an engine to drive.<br/> Use the <b>arrow keys</b> to steer.</p>
  </div>

  <div id="racer">
	<div id="mobile-controls">
		<div id="mobile-left" class="mobile-btn">
			<svg viewBox="0 0 24 24" width="48" height="48" fill="white"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
		</div>
		<div id="mobile-right" class="mobile-btn">
			<svg viewBox="0 0 24 24" width="48" height="48" fill="white"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/></svg>
		</div>
		<div id="mobile-back" class="mobile-btn">
			<svg viewBox="0 0 24 24" width="36" height="36" fill="white"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
		</div>
	</div>
    <div id="hud">
      <span id="speed"            class="hud"><span id="speed_value" class="value">0</span> mph</span>
      <span id="current_lap_time" class="hud">Time: <span id="current_lap_time_value" class="value">0.0</span></span> 
    </div>
    <canvas id="canvas">
      Sorry, this example cannot be run because your browser does not support the &lt;canvas&gt; element
    </canvas>
    Loading...
  </div>
	<div id="lap_complete_screen" class="text_screen">
		<div style="width: 60%; margin: 20px auto; height: 100px">
			Congratulations, you completed the lap in <span id="lap_time">999.99</span> seconds!<br/>
		</div>
		<div id="hiscore_register" style="width: 60%; margin: 10px auto;">
			<p>You earned your place in the local hall of fame!</p>
			<p>Enter your name: <input type="text" name="player" id="player_name" style="font-size: 30px; height: 35px; width: 300px; border: 1px solid black;" onkeypress="if (DIRECTOR.scene.playerNameKeypress) DIRECTOR.scene.playerNameKeypress(event)"/></p>
		</div>
		<div style="width:100%; text-align: center; margin: 30px;">
			<button id="ok_lap" onclick="DIRECTOR.scene.ok()" default="true">OK!</button>
		</div>
	</div>
	<div id="help_screen" class="text_screen">
		<div style="text-align: left; width: 600px; margin: 70px auto; font-size: 25px; line-height: 110%;">
			<h1 style="font-weight: bold; margin-bottom: 15px; text-decoration: underline">How to play?</h1>
			Hum like an engine to drive.<br/> Use the <b>arrow keys</b> to steer. <br/>Have fun.<br/><br/>
			If you feel that your voice is not being detected properly, try moving to a quieter environment and/or changing the "Mic sensitivity" setting.<br/><br/>
			<h1 style="font-weight: bold; margin-bottom: 15px; text-decoration: underline">About the project</h1>
			<p>
			This game is a single-weekend project implemented during the <a href="http://garage48.org/blogger/garage48-tallinn-2013-ideas-in-progress" target="_blank">Garage48</a> hackathon in Tallinn.
			</p>
			<p>
			Coding by <a href="http://kt.era.ee">Konstantin</a>. Some imagery by <a href="http://veli.ee/">Veli</a>. 
			The original <a href="http://codeincomplete.com/projects/racer/v4.final.html">Javascript racer</a> game by <a href="http://codeincomplete.com/about/">Jake Gordon</a>.
			</p>
		</div>
		<div style="text-align: center; width: 500px; margin: 70px auto;">
			<button id="ok_help" onclick="DIRECTOR.popScene(HelpScreen)" default="true">OK!</button>
		</div>
	</div>
	<div id="hiscore_screen" class="text_screen" style="color: white;">
		<div style="margin-top: 50px; text-align: center; font-size: 50px; font-weight: bold;">High scores</div>
		<div style="width: 90%; margin-left: auto;">
			<div style="float:left; width: 25%; margin: 20px 10px">
				<div style="width: 100%; text-align: center; padding: 10 20 10 20; font-size: 30px;">Short track</div>
				<div style="width: 100%; text-align: left; border-top: 1px solid white; padding: 20 20 20 60; font-size: 25px;">
					<table border="0" cellspacing="20px" cellpadding="20px" style="color:white">
						<thead>
						<tr><td style="width: 100px"></td></td></tr>
						</thead>
						<tbody id="hiscore_0">
						<tr><td>A</td><td>1.23</td></tr>
						<tr><td>A</td><td>1.23</td></tr>
						<tr><td>A</td><td>1.23</td></tr>
						</tbody>
					</table>
				</div>
			</div>
			<div style="float:left; width: 25%; margin: 20px 10px; border-right: 1px solid white; border-left: 1px solid white;">
				<div style="width: 100%; text-align: center; padding: 10 20 10 20; font-size: 30px;">Medium track</div>
				<div style="width: 100%; text-align: left; border-top: 1px solid white; padding: 20 20 20 60; font-size: 25px;">
					<table border="0" cellspacing="20px" cellpadding="20px" style="color:white">
						<thead>
						<tr><td style="width: 100px"></td></td></tr>
						</thead>
						<tbody id="hiscore_1">
						<tr><td>A</td><td>1.23</td></tr>
						<tr><td>A</td><td>1.23</td></tr>
						<tr><td>A</td><td>1.23</td></tr>
						</tbody>
					</table>
				</div>
			</div>
			<div style="float:left; width: 25%; margin: 20px 10px">
				<div style="width: 100%; text-align: center; padding: 10 20 10 20; font-size: 30px;">Long track</div>				
				<div style="width: 100%; text-align: left; border-top: 1px solid white; padding: 20 20 20 60; font-size: 25px;">
					<table border="0" cellspacing="20px" cellpadding="20px" style="color:white">
						<thead>
						<tr><td style="width: 100px"></td></td></tr>
						</thead>
						<tbody id="hiscore_2">
						<tr><td>A</td><td>1.23</td></tr>
						<tr><td>A</td><td>1.23</td></tr>
						<tr><td>A</td><td>1.23</td></tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div style="clear: both;"></div>
		<div style="text-align: center; margin-top: 50px;">
			<button id="ok_hiscore" onclick="DIRECTOR.popScene(HiscoreScreen)" default="true">OK!</button>
			<button id="reset_hiscore" onclick="if (DIRECTOR.scene.resetHiscore) DIRECTOR.scene.resetHiscore()" default="true">Reset</button>			
		</button>
	</div>

	<script src="js/stats.js"></script>
	<script src="js/common.js"></script>
	<script src="js/game.js"></script>
	<script src="js/jracer.js"></script>
	<script src="js/menu.js"></script>
	<script src="js/help.js"></script>
	<script src="js/hiscores.js"></script>
	<script src="js/lapcomplete.js"></script>
	<script src="js/mobile.js"></script>
	
	<span id="fullscreen"></span>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
	<script src="js/jquery.fullscreen-min.js"></script>
	<script>
		$('#fullscreen').click(function(e){
		  $(document).toggleFullScreen();
		});

		$(document).ready(function() {
			var gd = new GameDirector();
			window.DIRECTOR = gd;
			GameUtil.loadImages("images_tll", ["background", "sprites", "menu"], function(images) {	
				window.IMAGES = images;
				var menuScreen = new MenuScreen(640, 480);
				menuScreen.setImages(images[2]);
				gd.run(menuScreen);
			});
		});

	</script>

  <audio id="ding" src="sounds/ding.wav" preload="true"></audio>
  <audio id="click" src="sounds/click.wav" preload="true"></audio>
  <audio id="starter" src="sounds/starter.wav" preload="true"></audio>
  <audio id="v0" src="sounds/100-200.wav" preload="true"></audio>
  <audio id="v1" src="sounds/200-400.wav" preload="true"></audio>
  <audio id="v2" src="sounds/300-600.wav" preload="true"></audio>
 </body>
 </html>